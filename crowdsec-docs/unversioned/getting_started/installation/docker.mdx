---
id: docker
title: Docker
pagination_prev: getting_started/intro
pagination_next: getting_started/health_check
---

# Install with Docker or Podman

:::info
Prerequisites are written for bare metal installs. In containers, some of these items may not apply.
:::

:::warning
Since CrowdSec 1.7.0, it is mandatory to persist the `/var/lib/crowdsec/data` directory in a volume.

If you use the examples provided in this page, they will be.

If you write your own compose file, make sure you create a volume for it.

:::

New to CrowdSec? Start with the [introduction](/unversioned/getting_started/introduction.mdx) to understand the components and prerequisites.
This page installs the **Security Engine** (detection). To block attacks, add a [Remediation Component](/bouncers/intro.md) after installation.

## Docker

Make sure Docker is installed. If not, follow the [official Docker instructions](https://docs.docker.com/get-docker/).

### Run

The `docker run` command is useful for quick tests and development.

```bash
docker run -d \
  --name crowdsec \
  --volume /etc/crowdsec:/etc/crowdsec \
  --volume /var/lib/crowdsec/data/:/var/lib/crowdsec/data/ \
  --volume /var/log:/var/log:ro \
  --env COLLECTIONS="crowdsecurity/linux" \
  -p 127.0.0.1:8080:8080 \
  crowdsecurity/crowdsec:latest
```

For most users, we recommend Docker Compose for production. It lets you define services, volumes, and networks in a single file.

### Compose

Docker Compose is a tool for defining and running multi-container setups in a structured format. It uses a YAML file to configure the application's services, networks, and volumes.

Example snippet:

```yaml
crowdsec:
  image: crowdsecurity/crowdsec
  restart: always
  ports:
    - 127.0.0.1:8080:8080
  environment:
    COLLECTIONS: "crowdsecurity/nginx"
    GID: "${GID-1000}"
  depends_on:
    - "reverse-proxy"
  volumes:
    - ./crowdsec/acquis.yaml:/etc/crowdsec/acquis.yaml
    - logs:/var/log/nginx
    - crowdsec-db:/var/lib/crowdsec/data/
    - crowdsec-config:/etc/crowdsec/
```

:::info
`Compose` snippet was taken from our [example-docker-compose repository](https://github.com/crowdsecurity/example-docker-compose) which contains many examples of how CrowdSec container can be used in different setups.
:::

#### Compose key aspects

If you do not find an example that fits your needs, create your own `docker-compose.yml`. Here are the key aspects to keep in mind:

##### Provide access to logs

Because CrowdSec runs inside a container, you must mount log sources. In the example above, the `logs` volume is shared with the application container.

```yaml
volumes:
  - logs:/var/log/nginx
```

##### Persist data directories

The following directories _must_ be persisted, otherwise the container will refuse to start:

```yaml
volumes:
  - crowdsec-db:/var/lib/crowdsec/data/ ## Data Directory
  - crowdsec-config:/etc/crowdsec/ ## Configuration Directory
```

:::info
If you haven't used named volumes within Docker before you can read their [documentation here](https://docs.docker.com/storage/volumes/#use-a-volume-with-docker-compose)
:::

##### Use depends_on

The `depends_on` directive helps bring up the compose stack in order. In the snippet, the `reverse-proxy` container creates log files on startup, so we want it running first.

```yaml
depends_on:
  - "reverse-proxy"
```

## Environment variables

You can find a full list of available environment variables on our [Docker Hub image page](https://hub.docker.com/r/crowdsecurity/crowdsec).

Here are the most common environment variables for customizing CrowdSec in Docker:

| Variable             | Default                     | Description                                                                                           |
| -------------------- | --------------------------- | ----------------------------------------------------------------------------------------------------- |
| `COLLECTIONS`        | _(none)_                    | Space-separated list of CrowdSec collections to install (e.g., `crowdsecurity/nginx`).                |
| `TZ`                 | UTC                         | Timezone for logs (e.g., `Europe/London`).                                                            |
| `CONFIG_FILE`        | `/etc/crowdsec/config.yaml` | Path to the main config file. Useful if mounting a single file instead of a full directory.           |
| `LOCAL_API_URL`      | `http://0.0.0.0:8080`       | Where the Local API listens. Normally doesn't need to be changed unless you're running in agent mode. |
| `DISABLE_LOCAL_API`  | `false`                     | Set to `true` to disable LAPI and use this instance as a log processor only.                          |
| `DISABLE_AGENT`      | `false`                     | Set to `true` to disable the log processor and use this instance as an LAPI only.                     |
| `AGENT_USERNAME`     | _(none)_                    | Required only if `DISABLE_LOCAL_API` is true. Username for connecting to central LAPI.                |
| `AGENT_PASSWORD`     | _(none)_                    | Password for authenticating the agent.                                                                |
| `BOUNCER_KEY_<name>` | _(none)_                    | Seed value as API key for remediation under `<name>`                                                  |

:::tip
Use a `.env` file or Docker secrets to avoid hardcoding sensitive variables like passwords or API keys.
:::

## Automatic Hub Updates

To keep your CrowdSec installation up to date with the latest parsers, scenarios, and collections from the hub, you can set up an automated cron job that will check for updates and restart the container when needed.

### Docker Run Setup

For containers started with `docker run`, create this script:

```bash
#!/bin/bash
# /usr/local/bin/crowdsec-update.sh

CONTAINER_NAME="crowdsec"  # Adjust to your container name
DOCKER_BIN="/usr/bin/docker"  # Adjust path if needed
GREP_BIN="/usr/bin/grep"  # Adjust path if needed

# Check if container is running
if ! $DOCKER_BIN ps --format "table {{.Names}}" | $GREP_BIN -q "^${CONTAINER_NAME}$"; then
    echo "Container ${CONTAINER_NAME} is not running"
    exit 1
fi

# Update and check for upgrades
$DOCKER_BIN exec ${CONTAINER_NAME} cscli --error hub update >/dev/null
upgraded="$($DOCKER_BIN exec ${CONTAINER_NAME} cscli --error hub upgrade)"

if [ -n "$upgraded" ]; then
    echo "Hub updates detected, restarting container..."
    $DOCKER_BIN restart ${CONTAINER_NAME}
    echo "Container restarted successfully"
else
    echo "No hub updates available"
fi
```

### Docker Compose Setup

For Docker Compose deployments, use this script instead:

```bash
#!/bin/bash
# /usr/local/bin/crowdsec-update.sh

cd /path/to/your/docker-compose/directory  # Adjust path
DOCKER_BIN="/usr/bin/docker"  # Adjust path if needed
GREP_BIN="/usr/bin/grep"  # Adjust path if needed

# Check if service is running
if ! $DOCKER_BIN compose ps crowdsec | $GREP_BIN -q "Up"; then
    echo "CrowdSec service is not running"
    exit 1
fi

# Update and check for upgrades
$DOCKER_BIN compose exec crowdsec cscli --error hub update >/dev/null
upgraded="$($DOCKER_BIN compose exec crowdsec cscli --error hub upgrade)"

if [ -n "$upgraded" ]; then
    echo "Hub updates detected, restarting service..."
    $DOCKER_BIN compose restart crowdsec
    echo "Service restarted successfully"
else
    echo "No hub updates available"
fi
```

### Setup Instructions

1. **Choose the appropriate script** based on your deployment method
2. **Make it executable:**
   ```bash
   sudo chmod +x /usr/local/bin/crowdsec-update.sh
   ```
3. **Add to crontab** (daily at 2 AM):
   ```bash
   sudo crontab -e
   # Add: 0 2 * * * /usr/local/bin/crowdsec-update.sh
   ```

:::tip
**Docker Compose is recommended** as it doesn't require knowing the exact container name and works with the service name from your `docker-compose.yml`.

**Finding binary paths:**
```bash
# Find docker binary (includes compose subcommand)
which docker
# Common paths: /usr/bin/docker, /usr/local/bin/docker

# Find grep binary
which grep
# Common paths: /usr/bin/grep, /bin/grep
```

**Cron schedule examples:**
- `0 */6 * * *` - Every 6 hours
- `0 2 * * 0` - Every Sunday at 2 AM
- `0 2 1 * *` - First day of every month at 2 AM
:::

:::warning
Test your script manually before setting up the cron job to ensure it works with your specific setup.
:::

---

## Next steps

Great, you now have CrowdSec installed. Continue with the [post-installation steps](/getting_started/next_steps.mdx) to finish setup and optimize your deployment.
